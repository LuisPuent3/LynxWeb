<!DOCTYPE html>
<html>
<head>
    <title>Test NLP Service Mapping</title>
</head>
<body>
    <h1>Test NLP Service - Frontend Integration</h1>
    <div id="results"></div>
    
    <script>
        // Simular la respuesta de la API tal como la recibimos
        const simulatedAPIResponse = {
            success: true,
            processing_time_ms: 50,
            recommendations: [
                {
                    id: 33,
                    name: "Mazapan 28g",
                    price: 5.0,
                    image: "Mazapan.jpg",
                    category: "Golosinas",
                    relevance: 0.8,
                    stock: 28
                },
                {
                    id: 28,
                    name: "Flor de Naranjo 75g",
                    price: 10.0,
                    image: "florNaranjo.jpg",
                    category: "Snacks",
                    relevance: 0.8,
                    stock: 12
                },
                {
                    id: 17,
                    name: "Coca-Cola 600 ml sin az√∫car",
                    price: 19.0,
                    image: "cocasinazucar.jpg",
                    category: "Bebidas",
                    relevance: 0.8,
                    stock: 21
                }
            ]
        };
        
        // Simular el mapeo que hace nlpService
        function mapNLPProductsToFrontend(nlpProducts) {
            return nlpProducts.map(product => ({
                // Mapeo flexible - soporta tanto formato espa√±ol como ingl√©s
                id_producto: product.id_producto || product.id,
                nombre: product.nombre || product.name,
                precio: product.precio || product.price,
                cantidad: product.cantidad || product.stock || (product.available ? 10 : 0),
                id_categoria: product.id_categoria || 1,
                imagen: product.imagen || product.image || 'default.jpg',
                categoria: product.categoria || product.category,
                categoria_nombre: product.categoria_nombre || product.category,
                // Propiedades adicionales del NLP
                match_score: product.match_score || product.relevance || 0.8,
                match_reasons: product.match_reasons || [],
                // Propiedades por defecto que espera el frontend
                descripcion: product.descripcion || '',
                // Asegurar disponibilidad
                available: (product.cantidad || product.stock || 0) > 0
            }));
        }
        
        // Aplicar el mapeo
        const mappedProducts = mapNLPProductsToFrontend(simulatedAPIResponse.recommendations);
        
        // Mostrar resultados
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = `
            <h2>‚úÖ Productos Mapeados Correctamente</h2>
            <p><strong>Total productos:</strong> ${mappedProducts.length}</p>
            
            ${mappedProducts.map((product, index) => `
                <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                    <h3>${index + 1}. ${product.nombre}</h3>
                    <p><strong>üí∞ Precio:</strong> $${product.precio}</p>
                    <p><strong>üì¶ Stock:</strong> ${product.cantidad}</p>
                    <p><strong>üñºÔ∏è Imagen:</strong> ${product.imagen}</p>
                    <p><strong>üè∑Ô∏è Categor√≠a:</strong> ${product.categoria_nombre}</p>
                    <p><strong>‚≠ê Relevancia:</strong> ${product.match_score}</p>
                    <p><strong>‚úÖ Disponible:</strong> ${product.available ? 'S√≠' : 'No'}</p>
                </div>
            `).join('')}
        `;
        
        console.log('üîç Productos mapeados:', mappedProducts);
    </script>
</body>
</html>
