<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Sistema de Sin√≥nimos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
</head>
<body>
    <div id="root"></div>
    <script type="module">
        import React from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18/client';
        
        // Simulaci√≥n de SinonimosManager simplificado para pruebas directas
        const TestSynonymManager = () => {
            const [sinonimos, setSinonimos] = React.useState([]);
            const [loading, setLoading] = React.useState(false);
            const [nuevoSinonimo, setNuevoSinonimo] = React.useState('');
            
            const productoId = 1; // Coca-Cola
            const productoNombre = "Coca-Cola 600ml";
            
            const cargarSinonimos = React.useCallback(async () => {
                try {
                    setLoading(true);
                    const response = await fetch(`/api/test/sinonimos/producto/${productoId}`);
                    const data = await response.json();
                    console.log('Sin√≥nimos cargados:', data);
                    setSinonimos(Array.isArray(data) ? data : []);
                } catch (error) {
                    console.error('Error cargando sin√≥nimos:', error);
                } finally {
                    setLoading(false);
                }
            }, [productoId]);
            
            const agregarSinonimo = async (e) => {
                e.preventDefault();
                if (!nuevoSinonimo.trim()) return;
                
                try {
                    const response = await fetch('/api/test/sinonimos', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            producto_id: productoId,
                            sinonimo: nuevoSinonimo.trim().toLowerCase(),
                            fuente: 'admin'
                        })
                    });
                    
                    const result = await response.json();
                    console.log('Resultado agregar:', result);
                    
                    if (result.success) {
                        setNuevoSinonimo('');
                        await cargarSinonimos();
                        alert('¬°Sin√≥nimo agregado correctamente!');
                    } else {
                        alert('Error: ' + (result.detail || result.message));
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error de conexi√≥n');
                }
            };
            
            React.useEffect(() => {
                cargarSinonimos();
            }, [cargarSinonimos]);
            
            return React.createElement('div', { className: 'container mt-4' },
                React.createElement('div', { className: 'card' },
                    React.createElement('div', { className: 'card-header' },
                        React.createElement('h4', null, `üß™ Prueba: Sin√≥nimos para ${productoNombre}`)
                    ),
                    React.createElement('div', { className: 'card-body' },
                        // Formulario agregar
                        React.createElement('form', { onSubmit: agregarSinonimo, className: 'mb-4' },
                            React.createElement('div', { className: 'row' },
                                React.createElement('div', { className: 'col-md-8' },
                                    React.createElement('input', {
                                        type: 'text',
                                        className: 'form-control',
                                        placeholder: 'Ej: coca, cocacola, refresco cola',
                                        value: nuevoSinonimo,
                                        onChange: (e) => setNuevoSinonimo(e.target.value)
                                    })
                                ),
                                React.createElement('div', { className: 'col-md-4' },
                                    React.createElement('button', {
                                        type: 'submit',
                                        className: 'btn btn-primary w-100',
                                        disabled: !nuevoSinonimo.trim()
                                    }, '‚ûï Agregar Sin√≥nimo')
                                )
                            )
                        ),
                        
                        // Lista de sin√≥nimos
                        React.createElement('div', null,
                            React.createElement('h5', null, `üìù Sin√≥nimos (${sinonimos.length})`),
                            loading ? 
                                React.createElement('div', { className: 'text-center' }, '‚è≥ Cargando...') :
                                sinonimos.length === 0 ?
                                    React.createElement('div', { className: 'alert alert-info' }, 
                                        'No hay sin√≥nimos. ¬°Agrega el primero arriba!'
                                    ) :
                                    React.createElement('div', { className: 'list-group' },
                                        ...sinonimos.map((sin, i) => 
                                            React.createElement('div', { 
                                                key: i, 
                                                className: 'list-group-item d-flex justify-content-between align-items-center' 
                                            },
                                                React.createElement('div', null,
                                                    React.createElement('strong', null, sin.sinonimo),
                                                    React.createElement('small', { className: 'text-muted ms-2' }, 
                                                        `Popularidad: ${sin.popularidad} | Precisi√≥n: ${Math.round(sin.precision_score * 100)}%`
                                                    )
                                                ),
                                                React.createElement('span', { 
                                                    className: `badge bg-${sin.fuente === 'admin' ? 'primary' : 'info'}`
                                                }, sin.fuente === 'admin' ? 'Admin' : 'Auto')
                                            )
                                        )
                                    )
                        )
                    )
                )
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(TestSynonymManager));
    </script>
</body>
</html>
